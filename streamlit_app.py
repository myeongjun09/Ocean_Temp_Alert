import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt
import numpy as np

# -----------------------
# í˜ì´ì§€ ê¸°ë³¸ ì„¤ì •
# -----------------------
st.set_page_config(
    page_title="ë°”ë‹¤ì˜ ì˜¨ë„ ê²½ê³ ìŒ",
    page_icon="ğŸŒŠ",
    layout="wide"
)

# -----------------------
# ì œëª©
# -----------------------
st.title("ğŸŒŠ ë°”ë‹¤ì˜ ì˜¨ë„ ê²½ê³ ìŒ: í•´ìˆ˜ì˜¨ ìƒìŠ¹ê³¼ ì§€ì† ê°€ëŠ¥í•œ í•´ê²°ì±…")

st.markdown("""
ì´ ì•±ì€ í•´ìˆ˜ì˜¨ ìƒìŠ¹ì˜ ì›ì¸ê³¼ ì˜í–¥ì„ ë¶„ì„í•˜ê³ , ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ì—¬ ë³´ì—¬ì¤ë‹ˆë‹¤.  
ë˜í•œ ì‚¬ìš©ìê°€ ì§ì ‘ **ì—°ë„ ë²”ìœ„ì™€ ì§€ì—­**ì„ ì„ íƒí•´ ë³€í™”ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
""")

# -----------------------
# ì§€ì—­ ì„ íƒ
# -----------------------
st.sidebar.header("ğŸŒ ì§€ì—­ ì„ íƒ")
regions = ["ì „ ì„¸ê³„", "í•œêµ­ ì—°ì•ˆ", "íƒœí‰ì–‘", "ëŒ€ì„œì–‘", "ì¸ë„ì–‘", "ë¶ê·¹í•´", "ë‚¨ê·¹í•´"]
selected_region = st.sidebar.selectbox("ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”", regions)

# -----------------------
# ì˜ˆì‹œ ë°ì´í„° ìƒì„± (ì§€ì—­ë³„ ë°ì´í„° ì°¨ë³„í™”)
# -----------------------
years = np.arange(2000, 2026)

region_temp_offset = {
    "ì „ ì„¸ê³„": 0,
    "í•œêµ­ ì—°ì•ˆ": 0.2,
    "íƒœí‰ì–‘": 0.3,
    "ëŒ€ì„œì–‘": 0.1,
    "ì¸ë„ì–‘": 0.25,
    "ë¶ê·¹í•´": 1.0,   # ë¶ê·¹ì€ ì˜¨ë‚œí™”ê°€ ë” ì‹¬ê°
    "ë‚¨ê·¹í•´": 0.8
}

temperatures = 15 + region_temp_offset[selected_region] + 0.03 * (years - 2000) + np.random.normal(0, 0.1, len(years))

df = pd.DataFrame({
    "ì—°ë„": years,
    "í‰ê·  í•´ìˆ˜ì˜¨ë„(Â°C)": temperatures
})

# -----------------------
# ì—°ë„ ë²”ìœ„ ìŠ¬ë¼ì´ë”
# -----------------------
st.sidebar.header("ğŸ“… ì—°ë„ ì„ íƒ")
year_range = st.sidebar.slider(
    "ì—°ë„ ë²”ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš”",
    min_value=int(df["ì—°ë„"].min()),
    max_value=int(df["ì—°ë„"].max()),
    value=(2010, 2020)
)

# -----------------------
# ë°ì´í„° í•„í„°ë§
# -----------------------
filtered_df = df[(df["ì—°ë„"] >= year_range[0]) & (df["ì—°ë„"] <= year_range[1])]

# -----------------------
# ë³¸ë¡  1: ë°ì´í„° ì‹œê°í™”
# -----------------------
st.subheader(f"ğŸ“Š {selected_region} í•´ìˆ˜ì˜¨ ìƒìŠ¹ ì¶”ì„¸")

fig, ax = plt.subplots(figsize=(10, 5))
ax.plot(filtered_df["ì—°ë„"], filtered_df["í‰ê·  í•´ìˆ˜ì˜¨ë„(Â°C)"], marker="o", linestyle="-")
ax.set_xlabel("ì—°ë„")
ax.set_ylabel("í‰ê·  í•´ìˆ˜ì˜¨ë„ (Â°C)")
ax.set_title(f"{selected_region}: {year_range[0]}ë…„ ~ {year_range[1]}ë…„ í•´ìˆ˜ì˜¨ ì¶”ì„¸")
st.pyplot(fig)

# ë°ì´í„° í…Œì´ë¸”
st.dataframe(filtered_df, use_container_width=True)

# -----------------------
# ë³¸ë¡  2: ì˜í–¥ (ì„ íƒ ê°€ëŠ¥)
# -----------------------
st.subheader("ğŸŒ í•´ìˆ˜ì˜¨ ìƒìŠ¹ì˜ ì˜í–¥")

impact_options = st.multiselect(
    "ê´€ì‹¬ ìˆëŠ” ì˜í–¥ì„ ì„ íƒí•˜ì„¸ìš”",
    ["ì‚°í˜¸ì´ˆ ë°±í™”í˜„ìƒ", "ì–´ë¥˜ ì´ë™ ê²½ë¡œ ë³€í™”", "í•´ì•ˆ ë„ì‹œ ì¹¨ìˆ˜", "ê·¹ì§€ë°© ë¹™í•˜ ê°ì†Œ"],
    default=["ì‚°í˜¸ì´ˆ ë°±í™”í˜„ìƒ", "ì–´ë¥˜ ì´ë™ ê²½ë¡œ ë³€í™”"]
)

col1, col2 = st.columns(2)

if "ì‚°í˜¸ì´ˆ ë°±í™”í˜„ìƒ" in impact_options:
    with col1:
        st.markdown("#### ğŸª¸ ì‚°í˜¸ì´ˆ ë°±í™”í˜„ìƒ")
        st.image("https://upload.wikimedia.org/wikipedia/commons/0/0d/Coral_bleaching.jpg", caption="ì‚°í˜¸ì´ˆ ë°±í™”í˜„ìƒ", use_container_width=True)
        st.write("í•´ìˆ˜ì˜¨ ìƒìŠ¹ìœ¼ë¡œ ì¸í•´ ì‚°í˜¸ê°€ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì•„ ë°±í™”í˜„ìƒì´ ë°œìƒí•˜ë©°, ì´ëŠ” í•´ì–‘ ìƒë¬¼ ë‹¤ì–‘ì„± ê°ì†Œë¡œ ì´ì–´ì§‘ë‹ˆë‹¤.")

if "ì–´ë¥˜ ì´ë™ ê²½ë¡œ ë³€í™”" in impact_options:
    with col2:
        st.markdown("#### ğŸŸ ì–´ë¥˜ ì´ë™ ê²½ë¡œ ë³€í™”")
        st.image("https://upload.wikimedia.org/wikipedia/commons/4/49/Fish_school_in_Palau.jpg", caption="ì–´ë¥˜ ë¬´ë¦¬ ì´ë™", use_container_width=True)
        st.write("ì–´ë¥˜ëŠ” ì ì • ìˆ˜ì˜¨ì„ ì°¾ì•„ ì´ë™í•˜ëŠ”ë°, ìˆ˜ì˜¨ ìƒìŠ¹ìœ¼ë¡œ ê¸°ì¡´ì˜ ì–´íš ì§€ì—­ì´ ë³€í™”í•˜ì—¬ ì–´ì—… ìƒì‚°ëŸ‰ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤.")

if "í•´ì•ˆ ë„ì‹œ ì¹¨ìˆ˜" in impact_options:
    st.markdown("#### ğŸŒ† í•´ì•ˆ ë„ì‹œ ì¹¨ìˆ˜")
    st.image("https://upload.wikimedia.org/wikipedia/commons/3/3f/Miami_flooding.jpg", caption="í•´ìˆ˜ë©´ ìƒìŠ¹ìœ¼ë¡œ ì¸í•œ í•´ì•ˆ ë„ì‹œ ì¹¨ìˆ˜", use_container_width=True)
    st.write("í•´ìˆ˜ì˜¨ ìƒìŠ¹ì€ í•´ìˆ˜ë©´ ìƒìŠ¹ìœ¼ë¡œ ì´ì–´ì ¸, í•´ì•ˆ ë„ì‹œì˜ ì¹¨ìˆ˜ ìœ„í—˜ì„ ì¦ê°€ì‹œí‚µë‹ˆë‹¤.")

if "ê·¹ì§€ë°© ë¹™í•˜ ê°ì†Œ" in impact_options:
    st.markdown("#### ğŸ§Š ê·¹ì§€ë°© ë¹™í•˜ ê°ì†Œ")
    st.image("https://upload.wikimedia.org/wikipedia/commons/f/f3/Melting_Glacier.jpg", caption="ë¹™í•˜ ê°ì†Œ", use_container_width=True)
    st.write("ê·¹ì§€ë°©ì˜ ë¹™í•˜ê°€ ë¹ ë¥´ê²Œ ë…¹ìœ¼ë©´ì„œ ì „ ì„¸ê³„ í•´ìˆ˜ë©´ ìƒìŠ¹ì„ ê°€ì†í™”í•©ë‹ˆë‹¤.")

# -----------------------
# ë³¸ë¡  3: ì„¤ë¬¸ì¡°ì‚¬ ê²°ê³¼ (ì˜ˆì‹œ)
# -----------------------
st.subheader("ğŸ“‹ ë¯¸ë¦¼ë§ˆì´ìŠ¤í„°ê³  í•™ìƒ ì„¤ë¬¸ì¡°ì‚¬ (ì˜ˆì‹œ ë°ì´í„°)")

survey_data = pd.DataFrame({
    "ì‘ë‹µ": ["ë§¤ìš° ì‹¬ê°í•˜ë‹¤", "ì‹¬ê°í•˜ë‹¤", "ë³´í†µì´ë‹¤", "ë³„ë¡œ ì‹¬ê°í•˜ì§€ ì•Šë‹¤"],
    "ë¹„ìœ¨(%)": [40, 35, 20, 5]
})

st.bar_chart(survey_data.set_index("ì‘ë‹µ"))

# -----------------------
# ê²°ë¡  ë° ì œì–¸
# -----------------------
st.subheader("âœ… ê²°ë¡  ë° ì œì–¸")
st.markdown("""
- **êµ­ì œì  ì°¨ì›**: íƒ„ì†Œ ë°°ì¶œ ê·œì œ ê°•í™”, êµ­ì œ í˜‘ì•½ ì¤€ìˆ˜  
- **êµ­ê°€/ì§€ì—­ ì°¨ì›**: í•´ì–‘ ë³´í˜¸êµ¬ì—­ í™•ëŒ€, ì¹œí™˜ê²½ ì—ë„ˆì§€ ì „í™˜  
- **ê°œì¸ ì°¨ì›**: ì¼íšŒìš©í’ˆ ì¤„ì´ê¸°, ëŒ€ì¤‘êµí†µ ì´ìš©, ì¹œí™˜ê²½ ì†Œë¹„  
""")

# ì¶”ê°€: í•´ê²° ë°©ì•ˆ íˆ¬í‘œ
solution = st.radio(
    "ë‹¹ì‹ ì´ ê°€ì¥ ì‹¤ì²œí•  ìˆ˜ ìˆë‹¤ê³  ìƒê°í•˜ëŠ” ë°©ë²•ì€?",
    ["ì¼íšŒìš©í’ˆ ì¤„ì´ê¸°", "ëŒ€ì¤‘êµí†µ ì´ìš©", "ì¬í™œìš© ê°•í™”", "ì¹œí™˜ê²½ ì œí’ˆ êµ¬ë§¤"]
)
st.success(f"ğŸ‘ ì„ íƒí•˜ì‹  ì‹¤ì²œ ë°©ì•ˆ: {solution}")

st.info("ì‘ì€ í–‰ë™ì´ ëª¨ì—¬ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤. ìš°ë¦¬ ëª¨ë‘ê°€ ë°”ë‹¤ì˜ ëª©ì†Œë¦¬ì— ê·€ ê¸°ìš¸ì—¬ì•¼ í•  ë•Œì…ë‹ˆë‹¤.")
